/*
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    Cell Type Annotation Benchmarking Pipeline - Nextflow config
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
*/

// Load base config
includeConfig 'conf/base.config'

// Load params config
includeConfig 'conf/params.config'

// Load module-specific config
includeConfig 'conf/modules.config'

// Compute output directory
params.outdir_prefix = "${params.census_version}/${params.organism}/${params.subsample_query}/${params.ref_split}/${params.normalization_method}/gap_${params.use_gap}"
params.outdir = "$projectDir/${params.outdir_prefix}/ref_${params.subsample_ref}_cutoff_${params.cutoff}"

// DAG settings
dag.overwrite = true

// Trace settings
trace {
    enabled = true
    file = "${params.outdir}/trace.txt"
    overwrite = true
}

// Cleanup settings
nextflow {
    clean {
        afterRun = true
    }
}

// Profiles
profiles {
    conda {
        conda.enabled = true
    }

    slurm {
        process.executor = 'slurm'
        process.queue = 'default'
    }

    test {
        params.subsample_ref = 100
        params.subsample_query = 1000
    }

    test_hsap {
        includeConfig 'conf/test_hsap.config'
        process.executor = 'slurm'
    }

    test_mmus {
        includeConfig 'conf/test_mmus.config'
        process.executor = 'slurm'
    }

    debug {
        process.beforeScript = 'echo $HOSTNAME'
        cleanup = false
    }
}

// Manifest
manifest {
    name            = 'cell-annotation-benchmark'
    author          = 'rschwartz'
    homePage        = ''
    description     = 'Benchmarking pipeline for cell type annotation methods'
    mainScript      = 'main.nf'
    nextflowVersion = '!>=23.04.0'
    version         = '1.0.0'
}
