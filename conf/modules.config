/*
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    Config file for defining DSL2 per module options and publishing paths
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
*/

process {
    withName: 'SAVE_PARAMS' {
        publishDir = [
            path: { "${params.outdir}" },
            mode: 'copy'
        ]
    }

    withName: 'GET_CENSUS_ADATA' {
        publishDir = [
            [
                path: { "${params.outdir}/refs/scvi" },
                pattern: "**_umap.png",
                mode: 'copy'
            ],
            [
                path: { "${params.outdir}/refs/scvi" },
                pattern: "**.h5ad",
                mode: 'copy'
            ]
        ]
    }

    withName: 'REF_PROCESS_SEURAT' {
        publishDir = [
            path: { "${params.outdir}/refs/seurat" },
            pattern: "**.rds",
            mode: 'copy'
        ]
    }

    withName: 'CLASSIFY_ALL' {
        publishDir = [
            [
                path: { "${params.outdir}/${method}/${study_name}/${ref_name}/${query_name}" },
                pattern: "label_transfer_metrics**",
                mode: 'copy'
            ],
            [
                path: { "${params.outdir}/${method}/${study_name}/${ref_name}/${query_name}" },
                pattern: "confusion**",
                mode: 'copy'
            ],
            [
                path: { "${params.outdir}/${method}/${study_name}/${ref_name}/${query_name}" },
                pattern: "predicted_meta**",
                mode: 'copy'
            ]
        ]
    }

    // Uncomment when F1 plotting is enabled in workflow
    // withName: 'PLOT_F1_RESULTS_SCVI' {
    //     publishDir = [
    //         path: { "${params.outdir}/scvi" },
    //         mode: 'copy'
    //     ]
    // }

    // withName: 'PLOT_F1_RESULTS_SEURAT' {
    //     publishDir = [
    //         path: { "${params.outdir}/seurat" },
    //         mode: 'copy'
    //     ]
    // }

    withName: 'PLOT_QC_COMBINED' {
        publishDir = [
            path: { "${params.outdir}/${method}/${study_name}/${ref_name}/qc_plots" },
            mode: 'copy'
        ]
    }

    withName: 'MULTIQC' {
        publishDir = [
            path: { "${params.outdir}/multiqc_results" },
            pattern: "**multiqc_report.html",
            mode: 'copy'
        ]
    }
}
